实验二 循迹传感器模块的实现

一、实验目的

1. 掌握红外循迹传感器的工作原理及其在智能小车中的应用。
2. 学习通过单片机读取传感器信号，实现智能小车的循迹功能。
3. 理解传感器与单片机的接口设计方法，掌握数字信号的处理与判断。
4. 熟悉循迹算法的设计与实现，能够编写程序实现基本的循迹控制。

二、实验器材

- STC89C52RC单片机核心板 × 1
- 红外循迹传感器模块（TCRT5000） × 3-5个
- 智能小车底盘 × 1
- 10kΩ电阻 × 若干
- 杜邦线若干（公母头、母母头）
- 可调直流电源（5V） × 1
- 万用表 × 1
- 计算机（安装Keil、Proteus开发环境）
- 黑色电工胶带（用于制作循迹轨道）

三、分工情况

- 张旭阳：负责传感器电路搭建与硬件连接，Proteus仿真电路设计。
- 高佳愿：负责程序编写与调试，循迹算法设计与优化，实验报告撰写。

四、实验内容及步骤

1. 软件仿真（过程描述）

（1）仿真平台搭建
- 在Proteus中创建新工程，选取STC89C52RC单片机、TCRT5000红外传感器模型、LED指示灯等关键元件。
- 配置电源模块，设置合适的电压参数（5V逻辑电源）。
- 搭建传感器信号输入电路，模拟传感器输出信号。

（2）传感器信号仿真测试
- 编写程序实现传感器信号的读取与处理。
- 通过仿真环境模拟不同地面情况（白色地面、黑色轨道），观察传感器输出信号的变化。
- 测试多个传感器的协同工作，验证循迹逻辑的正确性。

（3）循迹算法仿真
- 设计基本的循迹算法：当传感器检测到黑线时输出低电平，检测到白色地面时输出高电平。
- 实现多传感器循迹逻辑：根据传感器阵列的状态判断小车位置，控制小车转向。
- 仿真测试小车在不同轨道情况下的循迹性能。

2. 分析理解循迹传感器模块的原理和作用，说明传感器模块与单片机的引脚连接关系

（1）TCRT5000红外循迹传感器工作原理

TCRT5000是一种反射式红外光电传感器，由红外发射管和红外接收管组成。其工作原理如下：
- 红外发射管发出红外光，照射到地面。
- 红外接收管接收反射回来的红外光。
- 当传感器位于白色地面上时，反射光较强，接收管导通，输出低电平（或高电平，取决于电路设计）。
- 当传感器位于黑色轨道上时，反射光较弱，接收管截止，输出高电平（或低电平）。

（2）传感器模块的作用

- 检测地面颜色：通过检测反射光的强度，判断传感器下方是白色地面还是黑色轨道。
- 提供位置信息：多个传感器组成传感器阵列，可以判断小车相对于轨道的相对位置。
- 实现循迹控制：根据传感器阵列的输出信号，控制小车的转向和速度，使小车沿着黑色轨道行驶。

（3）传感器模块与单片机的引脚连接关系

- 传感器1输出端 → 单片机P3.2（INT0外部中断引脚，或普通I/O口）
- 传感器2输出端 → 单片机P3.3（INT1外部中断引脚，或普通I/O口）
- 传感器3输出端 → 单片机P3.4（普通I/O口）
- 传感器4输出端 → 单片机P3.5（普通I/O口）
- 传感器5输出端 → 单片机P3.6（普通I/O口）
- 传感器模块VCC → +5V电源
- 传感器模块GND → 共同接地端

（4）传感器阵列布局

典型的五传感器阵列布局（从左到右）：
- 传感器1：最左侧传感器
- 传感器2：左侧传感器
- 传感器3：中间传感器
- 传感器4：右侧传感器
- 传感器5：最右侧传感器

五、实验结果

1. 软件仿真结果

- 传感器信号读取：在Proteus仿真中，成功读取各传感器的输出信号，当模拟黑线经过传感器下方时，传感器输出信号正确变化。
- 循迹算法验证：仿真测试中，小车能够根据传感器阵列的状态正确判断位置，并执行相应的转向控制。
- 多传感器协同：多个传感器协同工作正常，能够准确检测轨道位置。

2. 电路实现结果

- 传感器安装：成功将5个TCRT5000传感器安装在小车前端，传感器间距约2cm，传感器高度距离地面约1-2cm。
- 信号检测：实际测试中，传感器能够准确区分白色地面和黑色轨道，输出信号稳定可靠。
- 循迹功能：小车能够沿着黑色轨道行驶，当偏离轨道时能够及时调整方向，循迹效果良好。

六、实验总结

1. 小组总结

本次实验成功实现了基于TCRT5000红外传感器的智能小车循迹功能。在实验过程中，团队成员密切配合，从传感器原理学习、电路搭建到程序编写与调试，系统掌握了循迹传感器的工作原理和应用方法。

通过本次实验，我们深入理解了反射式红外传感器的工作原理，掌握了传感器与单片机的接口设计方法，学会了循迹算法的设计与实现。在调试过程中，我们发现传感器的高度和灵敏度调节对循迹效果有重要影响，通过反复调试找到了最佳参数。这次实践不仅提升了我们的硬件调试能力，也增强了我们解决实际工程问题的能力。

2. 个人总结

- 张旭阳：在本次实验中，我主要负责传感器电路的搭建和硬件连接。通过实际动手操作，我对TCRT5000传感器的引脚功能、工作特性有了直观的认识。在调试过程中，我学会了如何调节传感器的灵敏度，如何优化传感器的安装位置和高度。这次实验让我深刻体会到硬件调试需要耐心和细致，每一个细节都可能影响最终效果。

- 高佳愿：我主要负责程序编写和循迹算法的设计。在编写程序时，我深入理解了传感器信号的读取与处理逻辑，学会了如何根据传感器阵列的状态判断小车位置。通过不断调试和优化算法，我解决了传感器响应延迟、小车转向过度等问题，提升了编程和调试能力。同时，也认识到算法设计需要结合实际硬件特性，只有软硬件紧密结合，才能实现良好的循迹效果。

思考题

1. 源程序（有详细注释）

```c
#include <reg52.h>

// 传感器引脚定义
sbit SENSOR1 = P3^2;  // 最左侧传感器
sbit SENSOR2 = P3^3;  // 左侧传感器
sbit SENSOR3 = P3^4;  // 中间传感器
sbit SENSOR4 = P3^5;  // 右侧传感器
sbit SENSOR5 = P3^6;  // 最右侧传感器

// 电机控制引脚定义（假设使用P1口控制L298N）
sbit MOTOR1_PIN1 = P1^0;  // 左电机控制1
sbit MOTOR1_PIN2 = P1^1;  // 左电机控制2
sbit MOTOR2_PIN1 = P1^2;  // 右电机控制1
sbit MOTOR2_PIN2 = P1^3;  // 右电机控制2

// 延时函数
void Delay_ms(unsigned int ms)
{
    unsigned int i, j;
    for(i = 0; i < ms; i++)
        for(j = 0; j < 113; j++);
}

// 读取传感器状态函数
unsigned char Read_Sensors()
{
    unsigned char sensor_state = 0;
    
    // 读取5个传感器的状态，0表示检测到黑线，1表示检测到白色地面
    if(SENSOR1 == 0) sensor_state |= 0x01;  // 最左侧传感器
    if(SENSOR2 == 0) sensor_state |= 0x02;  // 左侧传感器
    if(SENSOR3 == 0) sensor_state |= 0x04;  // 中间传感器
    if(SENSOR4 == 0) sensor_state |= 0x08;  // 右侧传感器
    if(SENSOR5 == 0) sensor_state |= 0x10;  // 最右侧传感器
    
    return sensor_state;
}

// 循迹控制函数
void Track_Control()
{
    unsigned char sensor_state = Read_Sensors();
    
    // 根据传感器状态控制小车运动
    switch(sensor_state)
    {
        case 0x04:  // 只有中间传感器检测到黑线，直行
            MOTOR1_PIN1 = 1;
            MOTOR1_PIN2 = 0;
            MOTOR2_PIN1 = 1;
            MOTOR2_PIN2 = 0;
            break;
            
        case 0x02:  // 左侧传感器检测到黑线，左转
        case 0x01:
            MOTOR1_PIN1 = 0;
            MOTOR1_PIN2 = 0;
            MOTOR2_PIN1 = 1;
            MOTOR2_PIN2 = 0;
            break;
            
        case 0x08:  // 右侧传感器检测到黑线，右转
        case 0x10:
            MOTOR1_PIN1 = 1;
            MOTOR1_PIN2 = 0;
            MOTOR2_PIN1 = 0;
            MOTOR2_PIN2 = 0;
            break;
            
        case 0x00:  // 所有传感器都检测到黑线，可能是十字路口，直行
        case 0x1F:  // 所有传感器都检测到白色，可能偏离轨道，停止或搜索
        default:
            MOTOR1_PIN1 = 0;
            MOTOR1_PIN2 = 0;
            MOTOR2_PIN1 = 0;
            MOTOR2_PIN2 = 0;
            break;
    }
}

// 主函数
void main()
{
    while(1)
    {
        Track_Control();  // 执行循迹控制
        Delay_ms(10);     // 延时，控制循迹响应速度
    }
}
```

2. 简述TCRT5000传感器的工作原理（结合源程序）

TCRT5000是一种反射式红外光电传感器，由红外发射管和红外接收管组成。其工作原理如下：

- 红外发射管发出红外光，照射到地面。
- 红外接收管接收反射回来的红外光。
- 当传感器位于白色地面上时，反射光较强，接收管导通，输出低电平（在源程序中，SENSORx == 0表示检测到黑线，这取决于具体的电路设计，有些电路设计是反相的）。
- 当传感器位于黑色轨道上时，反射光较弱，接收管截止，输出高电平。

在源程序中，通过读取P3口的各个引脚状态来判断传感器是否检测到黑线。当传感器检测到黑线时，对应的引脚为低电平（0），程序通过位操作将传感器状态组合成一个字节，然后根据不同的传感器状态组合，控制小车的运动方向。

3. 简述循迹算法的设计思路（结合源程序）

循迹算法的设计思路是根据传感器阵列的状态来判断小车相对于轨道的位置，然后控制小车转向，使小车始终沿着轨道行驶。

在源程序中，循迹算法的实现如下：

- 读取传感器状态：通过Read_Sensors()函数读取5个传感器的状态，将状态组合成一个字节。
- 判断位置：根据传感器状态判断小车位置：
  - 只有中间传感器检测到黑线（0x04）：小车在轨道中央，直行。
  - 左侧传感器检测到黑线（0x02或0x01）：小车偏右，需要左转。
  - 右侧传感器检测到黑线（0x08或0x10）：小车偏左，需要右转。
  - 所有传感器都检测到黑线（0x00）：可能是十字路口，直行。
  - 所有传感器都检测到白色（0x1F）：可能偏离轨道，停止。
- 控制运动：根据判断结果，控制左右电机的转向，实现小车的转向控制。

4. TCRT5000传感器的说明资料（包括引脚图等）

TCRT5000红外反射式传感器技术规格：

（1）引脚功能
- 引脚1：红外发射管正极（Anode）
- 引脚2：红外发射管负极（Cathode）
- 引脚3：红外接收管集电极（Collector）
- 引脚4：红外接收管发射极（Emitter）

（2）主要特性
- 工作电压：3.3V - 5V
- 工作电流：典型值20mA
- 检测距离：1mm - 25mm（可调）
- 响应时间：< 10μs
- 工作温度：-25°C ~ +85°C

（3）应用说明
- 检测距离可通过调节传感器高度或灵敏度电位器来调整。
- 传感器对环境的适应性较好，但在强光环境下可能受到影响。
- 建议传感器距离地面1-2cm，以获得最佳的检测效果。

